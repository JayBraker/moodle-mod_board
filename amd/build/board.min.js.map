{"version":3,"sources":["../src/board.js"],"names":["define","$","Str","Ajax","Notification","_serviceCall","method","args","callback","failcallback","call","methodname","done","data","bind","fail","error","exception","isAriaTriggerKey","key","board","options","strings","default_column_heading","post_button_text","cancel_button_text","remove_note_text","remove_column_text","note_changed_text","note_deleted_text","Ok","Cancel","warning","option_youtube","option_youtube_info","option_youtube_url","option_image","option_image_info","option_image_url","option_link","option_link_info","option_link_url","option_empty","aria_newcolumn","aria_newpost","aria_deletecolumn","aria_deletepost","aria_addmedia","aria_deleteattachment","MEDIA_SELECTION_BUTTONS","reloadTimer","lastHistoryId","isEditor","userId","mediaSelection","mediaselection","noteTextCache","noteHeadingCache","attachmentCache","editingNote","isReadOnlyBoard","readonly","serviceCall","stopUpdating","apply","arguments","updateBoard","getNote","ident","getNoteText","getNoteTextForNote","note","find","getNoteHeading","getNoteHeadingForNote","getNoteButtonsForNote","showNewNoteButtons","show","hideNewNoteButtons","hide","getNoteAttachmentsForNote","successNoteEdit","stopNoteEdit","remove","html","setAttachment","previewAttachment","noteHeading","startNoteEdit","pendingNote","attachmentDataForNote","deleteNote","confirm","id","result","status","historyid","attachmentTypeChanged","noteAttachment","type","val","attachmentInfo","attachmentUrl","attachmentIcon","removeAttachment","prop","attachmentTypeToString","removeClass","addClass","attachmentFAIcon","attachment","attType","info","url","length","attachmentFAIcons","elem","fixEmbedUrlIfNeeded","replace","parseInt","addNote","columnid","heading","content","owner","ismynote","iseditable","notecontent","noteText","attachmentPreview","append","attachmentType","on","trigger","column_content","column_name","buttons","postbutton","cancelbutton","ytButton","imgButton","linkButton","removeElement","text","e","keyCode","preventDefault","editable","beginEdit","is","dblclick","sendAttach","addHeading","addText","sortNotes","toggleFontSize","closeOnEnter","lastOne","last","insertAfter","prepend","addColumn","name","notes","nameCache","column","column_header","column_sort","column_newcontent","noteicon","index","userid","addNewColumnButton","newBusy","columnicon","boardid","processBoardHistory","since","boardhistory","item","JSON","parse","action","updateNote","split","alert","instant","setTimeout","clearTimeout","toggle","sort_col","parent","direction","sort","a","b","appendTo","init","columns","stringsInfo","string","push","component","when","get_strings","results"],"mappings":"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","sourcesContent":["define(['jquery', 'core/str', 'core/ajax', 'core/notification', 'core/templates', 'mod_board/jquery.editable.amd'], function($, Str, Ajax, Notification, Templates) {\r\n    \r\n    var _serviceCall = function(method, args, callback, failcallback) {\r\n        Ajax.call([{\r\n            methodname: 'mod_board_' + method,\r\n            args: args,\r\n            done: function(data) {\r\n                callback(data);\r\n            }.bind(this),\r\n            fail: function(error) {\r\n                Notification.exception(error);\r\n                if (failcallback) {\r\n                    failcallback(error);\r\n                }\r\n            }\r\n        }]);\r\n    };\r\n    \r\n    var isAriaTriggerKey = function(key) {\r\n        return key===13 || key===32;\r\n    }\r\n        \r\n    return function(board, options) {\r\n        var strings = {\r\n            default_column_heading: '',\r\n            post_button_text: '',\r\n            cancel_button_text: '',\r\n            remove_note_text: '',\r\n            remove_column_text: '',\r\n            note_changed_text: '',\r\n            note_deleted_text: '',\r\n            Ok: '',\r\n            Cancel: '',\r\n            warning: '',\r\n            option_youtube: '',\r\n            option_youtube_info: '',\r\n            option_youtube_url: '',\r\n            option_image: '',\r\n            option_image_info: '',\r\n            option_image_url: '',\r\n            option_link: '',\r\n            option_link_info: '',\r\n            option_link_url: '',\r\n            option_empty: '',\r\n            \r\n            aria_newcolumn: '',\r\n            aria_newpost: '',\r\n            aria_deletecolumn: '',\r\n            aria_deletepost: '',\r\n            aria_addmedia: '',\r\n            aria_deleteattachment: ''\r\n        };\r\n        \r\n        const MEDIA_SELECTION_BUTTONS = 1;\r\n        const MEDIA_SELECTION_DROPDOWN = 2;\r\n        var reloadTimer = null;\r\n        var lastHistoryId = null;\r\n        var isEditor = options.isEditor || false;\r\n        var userId = options.userId || -1;\r\n        var mediaSelection = options.mediaselection || MEDIA_SELECTION_BUTTONS;\r\n        var noteTextCache = null, noteHeadingCache = null, attachmentCache = null;\r\n        var editingNote = 0;\r\n        var isReadOnlyBoard = options.readonly || false;\r\n        \r\n        var serviceCall = function(method, args, callback, failcallback) {\r\n            if (method!=='board_history') {\r\n                stopUpdating();\r\n            }\r\n            _serviceCall(method, args, function() {\r\n                callback.apply(null, arguments);\r\n                if (method!=='board_history') {\r\n                    updateBoard(true);\r\n                }\r\n            }, failcallback);\r\n        };\r\n        \r\n        var getNote = function(ident) {\r\n            return $(\".board_note[data-ident='\"+ident+\"']\");\r\n        };\r\n        \r\n        var getNoteText = function(ident) {\r\n            return $(\".board_note[data-ident='\"+ident+\"'] .note_text\");\r\n        };\r\n        \r\n        var getNoteTextForNote = function(note) {\r\n            return $(note).find(\".note_text\");\r\n        };\r\n        \r\n        var getNoteHeading = function(ident) {\r\n            return $(\".board_note[data-ident='\"+ident+\"'] .note_heading\");\r\n        };\r\n        \r\n        var getNoteHeadingForNote = function(note) {\r\n            return $(note).find(\".note_heading\");\r\n        };\r\n        \r\n        var getNoteButtonsForNote = function(note) {\r\n            return $(note).find(\".note_buttons\");\r\n        };\r\n        \r\n        var showNewNoteButtons = function() {\r\n            $('.board_column .board_column_newcontent .board_button.newnote').show();\r\n        };\r\n        \r\n        var hideNewNoteButtons = function() {\r\n            $('.board_column .board_column_newcontent .board_button.newnote').hide();\r\n        };\r\n        \r\n        var getNoteAttachmentsForNote = function(note) {\r\n            return $(note).find(\".note_attachment\");\r\n        };\r\n        \r\n        var successNoteEdit = function() {\r\n            noteTextCache = null;\r\n            noteHeadingCache = null;\r\n            attachmentCache = null;\r\n            stopNoteEdit();\r\n        };\r\n        \r\n        var stopNoteEdit = function() {\r\n            if (!editingNote) {\r\n                getNote(0).remove();\r\n                showNewNoteButtons();\r\n                return;\r\n            }\r\n            \r\n            if (noteTextCache) {\r\n                getNoteText(editingNote).html(noteTextCache);\r\n                noteTextCache = null;\r\n            }\r\n            \r\n            if (noteHeadingCache) {\r\n                getNoteHeading(editingNote).html(noteHeadingCache);\r\n                noteHeadingCache = null;\r\n            }\r\n            \r\n            var note = getNote(editingNote);\r\n            \r\n            if (note) {\r\n                if (attachmentCache) {\r\n                    setAttachment(note, attachmentCache);\r\n                    attachmentCache = null;\r\n                } else {\r\n                    previewAttachment(note);\r\n                }\r\n\r\n                getNoteButtonsForNote(note).hide();\r\n                getNoteAttachmentsForNote(note).hide();\r\n                showNewNoteButtons();\r\n                var noteHeading = getNoteHeadingForNote(note);\r\n                if (!noteHeading.html()) {\r\n                    noteHeading.hide();\r\n                }\r\n            }\r\n            \r\n            editingNote = 0;\r\n        };\r\n        \r\n        var startNoteEdit = function(ident) {\r\n            if (editingNote) {\r\n                if (editingNote==ident) {\r\n                    return;\r\n                }\r\n                stopNoteEdit();\r\n            }\r\n            \r\n            if (ident) {\r\n                var pendingNote = getNote(0);\r\n                if (pendingNote) {\r\n                    pendingNote.remove();\r\n                }\r\n            }\r\n            \r\n            var note = getNote(ident);\r\n            if (note) {\r\n                getNoteButtonsForNote(note).show();\r\n                getNoteAttachmentsForNote(note).show();\r\n                hideNewNoteButtons();\r\n                \r\n                var noteHeading = getNoteHeadingForNote(note);\r\n                if (ident) {\r\n                    attachmentCache = attachmentDataForNote(note);\r\n                    noteTextCache = getNoteTextForNote(note).html();\r\n                    noteHeadingCache = noteHeading.html();\r\n                    editingNote = ident;\r\n                }\r\n                noteHeading.show();\r\n            }\r\n        };\r\n        \r\n        var deleteNote = function(ident) {\r\n            if (confirm(strings.remove_note_text)) {\r\n                serviceCall('delete_note', {id: ident}, function(result) {\r\n                    if (result.status) {\r\n                        lastHistoryId = result.historyid;\r\n                        getNote(ident).remove();\r\n                    }\r\n                });\r\n            }\r\n        };\r\n        \r\n        var attachmentTypeChanged = function(note) {\r\n            var noteAttachment = getNoteAttachmentsForNote(note);\r\n            var type = noteAttachment.find('.type').val();\r\n            \r\n            var attachmentInfo = noteAttachment.find('.info');\r\n            var attachmentUrl = noteAttachment.find('.url');\r\n            \r\n            if (mediaSelection==MEDIA_SELECTION_BUTTONS) {\r\n                var attachmentIcon = noteAttachment.find('.type_icon');\r\n                var removeAttachment = noteAttachment.find('.remove_attachment');\r\n            } else {\r\n                getNoteButtonsForNote(note).find('.attachment_button').hide();\r\n            }\r\n                \r\n            if (type>\"0\") {\r\n                if (mediaSelection==MEDIA_SELECTION_BUTTONS) {\r\n                    removeAttachment.show();\r\n                }\r\n                attachmentInfo.prop('placeholder', strings['option_'+attachmentTypeToString(type)+'_info']);\r\n                attachmentUrl.prop('placeholder', strings['option_'+attachmentTypeToString(type)+'_url']);\r\n                \r\n                attachmentInfo.show();\r\n                attachmentUrl.show();\r\n                \r\n                if (mediaSelection==MEDIA_SELECTION_BUTTONS) {\r\n                    attachmentIcon.removeClass().addClass(['type_icon', 'fa', attachmentFAIcon(type)]);\r\n                    attachmentIcon.show();\r\n                    getNoteButtonsForNote(note).find('.attachment_button').hide();\r\n                }\r\n            } else {\r\n                if (mediaSelection==MEDIA_SELECTION_BUTTONS) {\r\n                    removeAttachment.hide();\r\n                }\r\n                attachmentInfo.hide();\r\n                attachmentUrl.hide();\r\n                if (mediaSelection==MEDIA_SELECTION_BUTTONS) {\r\n                    attachmentIcon.hide();\r\n                }\r\n                attachmentInfo.val('');\r\n                attachmentUrl.val('');\r\n                if (mediaSelection==MEDIA_SELECTION_BUTTONS) {\r\n                    getNoteButtonsForNote(note).find('.attachment_button').show();\r\n                }\r\n            }\r\n        }\r\n        \r\n        var setAttachment = function(note, attachment) {\r\n            var noteAttachment = getNoteAttachmentsForNote(note);\r\n            if (noteAttachment) {\r\n                if (!attachment) {\r\n                    attachment = {type: \"0\"};\r\n                } else {\r\n                    attachment.type += \"\";//just in case\r\n                }\r\n                var attType = noteAttachment.find('.type');\r\n                attType.val(attachment.type?attachment.type: \"0\");\r\n                if (attType.val()>\"0\") {\r\n                    noteAttachment.find('.info').val(attachment.info);\r\n                    noteAttachment.find('.url').val(attachment.url);\r\n                }\r\n                attachmentTypeChanged(note, attachment);\r\n            }\r\n            previewAttachment(note, attachment);\r\n        };\r\n        \r\n        var attachmentDataForNote = function(note) {\r\n            var attachment = { type: 0, info: null, url: null };\r\n            var noteAttachment = getNoteAttachmentsForNote(note);\r\n            if (noteAttachment) {\r\n                attachment.type = noteAttachment.find('.type').val();\r\n                attachment.info = noteAttachment.find('.info').val();\r\n                attachment.url = noteAttachment.find('.url').val();\r\n            }\r\n            if (!attachment.info.length && !attachment.url.length) {\r\n                attachment.type = 0;\r\n            }\r\n            \r\n            return attachment;\r\n        };\r\n        \r\n        var attachmentTypeToString = function(type) {\r\n            switch(type) {\r\n                case \"1\": return 'youtube';\r\n                case \"2\": return 'image';\r\n                case \"3\": return 'link';\r\n                default: return null;\r\n            }\r\n        };\r\n        \r\n        var attachmentFAIcons = ['fa-youtube', 'fa-picture-o', 'fa-link'];\r\n        var attachmentFAIcon = function(type) {\r\n            return attachmentFAIcons[type-1] || null;\r\n        }\r\n        \r\n        var previewAttachment = function(note, attachment) {\r\n            var elem = note.find('.preview');\r\n            if (!attachment) {\r\n                attachment = attachmentDataForNote(note);\r\n            }\r\n            var fixEmbedUrlIfNeeded = function(url) {\r\n                return url.replace(/watch\\?v=/gi, '/embed/').replace(/youtu\\.be/, 'youtube.com/embed');\r\n            };\r\n            \r\n            if (!getNoteTextForNote(note).html().length) {\r\n                elem.addClass('notext');\r\n            } else {\r\n                elem.removeClass('notext');\r\n            }\r\n            \r\n            elem.removeClass('wrapper_youtube');\r\n            elem.removeClass('wrapper_image');\r\n            elem.removeClass('wrapper_url');\r\n            if (attachment.url) {\r\n                switch(parseInt(attachment.type)) {\r\n                    case 1: //youtube\r\n                        elem.html('<iframe src=\"'+ fixEmbedUrlIfNeeded(attachment.url) +'\" class=\"preview_element\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>');\r\n                        elem.addClass('wrapper_youtube');\r\n                        elem.show();\r\n                    break;\r\n                    case 2: // image\r\n                        elem.html('<img src=\"'+ attachment.url +'\" class=\"preview_element\" alt=\"'+ attachment.info +'\"/>');\r\n                        elem.addClass('wrapper_image');\r\n                        elem.show();\r\n                    break;\r\n                    case 3: // url\r\n                        elem.html('<a href=\"'+ attachment.url +'\" class=\"preview_element\" target=\"_blank\">' + (attachment.info || attachment.url) + '</a>');\r\n                        elem.addClass('wrapper_url');\r\n                        elem.show();\r\n                    break;\r\n                    default:\r\n                        elem.html('');\r\n                        elem.hide();\r\n                }\r\n            } else {\r\n                elem.html('');\r\n                elem.hide();\r\n            }\r\n        };\r\n        \r\n        var addNote = function(columnid, ident, heading, content, attachment, owner) {\r\n            var ismynote = owner.id==userId || !ident;\r\n            var iseditable = isEditor || (ismynote && !isReadOnlyBoard);\r\n            \r\n            if (!ident) {\r\n                var pendingNote = getNote(0);\r\n                if (pendingNote) {\r\n                    pendingNote.remove();\r\n                }\r\n            }\r\n            \r\n            var note = $('<div class=\"board_note\" data-ident=\"'+ident+'\"></div>');\r\n            if (ismynote) {\r\n                note.addClass('mynote');\r\n            }\r\n            if (iseditable) {\r\n                note.addClass('editablenote');\r\n            }\r\n            \r\n            var notecontent = $('<div class=\"note_content\"></div>');\r\n            var noteHeading = $('<div class=\"note_heading\" tabindex=\"0\" aria-level=\"4\" role=\"heading\">' + (heading?heading:'') + '</div>');\r\n            var noteText = $('<div class=\"note_text\" tabindex=\"0\">' + (content?content:'') + '</div>');\r\n            var attachmentPreview = $('<div class=\"preview\"></div>');\r\n            if (iseditable) {\r\n                var noteAttachment = $('<div class=\"note_attachment form-group row\" tabindex=\"0\">' +\r\n                                    '<select class=\"type form-control form-control-sm '+(mediaSelection==MEDIA_SELECTION_BUTTONS?'hidden':'')+'\">' +\r\n                                        '<option value=\"0\">'+strings.option_empty+'</option>' +\r\n                                        '<option value=\"1\">'+strings.option_youtube+'</option>' +\r\n                                        '<option value=\"2\">'+strings.option_image+'</option>' +\r\n                                        '<option value=\"3\">'+strings.option_link+'</option>' +\r\n                                    '</select>' +\r\n                                    '<span class=\"type_icon fa '+(mediaSelection==MEDIA_SELECTION_DROPDOWN?'hidden':'')+'\"></span>'+\r\n                                    '<input type=\"text\" class=\"info form-control form-control-sm col-sm-12 '+(mediaSelection==MEDIA_SELECTION_BUTTONS?'with_type_icon':'')+'\" placeholder=\"\">' +\r\n                                    '<input type=\"text\" class=\"url form-control form-control-sm col-sm-12\" placeholder=\"\">' +\r\n                                '</div>'\r\n                            );\r\n                \r\n                noteAttachment.hide();\r\n            }\r\n            \r\n            notecontent.append(noteHeading);\r\n            notecontent.append(noteText);\r\n            if (iseditable) {\r\n                notecontent.append(noteAttachment);\r\n            }\r\n            \r\n            notecontent.append(attachmentPreview);\r\n            note.append(notecontent);\r\n            \r\n            if (iseditable) {\r\n                var attachmentType = noteAttachment.find('.type');\r\n                var attachmentInfo = noteAttachment.find('.info');\r\n                var attachmentUrl = noteAttachment.find('.url');\r\n                var attachmentIcon = noteAttachment.find('.type_icon');\r\n                \r\n                attachmentType.on('change', function() {\r\n                    attachmentTypeChanged(note);\r\n                    previewAttachment(note);\r\n                });\r\n                \r\n                attachmentUrl.on('change', function() {\r\n                    previewAttachment(note);\r\n                });\r\n                \r\n                attachmentInfo.on('change', function() {\r\n                    previewAttachment(note);\r\n                });\r\n                \r\n                if (mediaSelection==MEDIA_SELECTION_BUTTONS) {\r\n                    var removeAttachment = $('<div class=\"remove remove_attachment fa fa-remove\" aria-label=\"'+strings.aria_deleteattachment+'\"></div>');\r\n                    removeAttachment.hide();\r\n                    removeAttachment.on('click', function() { attachmentType.val(0); attachmentType.trigger('change'); });\r\n                    noteAttachment.append(removeAttachment);\r\n                }\r\n            }\r\n            \r\n            var column_content = $('.board_column[data-ident='+columnid+'] .board_column_content');\r\n            var column_name = $('.board_column[data-ident='+columnid+'] .column_name');\r\n            \r\n            if (iseditable) {\r\n                var buttons = $('<div class=\"note_buttons\"></div>');\r\n                buttons.hide();\r\n                var postbutton = $('<div class=\"post_button action_button\" role=\"button\" tabindex=\"0\">'+strings.post_button_text+'</div>');\r\n                var cancelbutton = $('<div class=\"cancel_button action_button\" role=\"button\" tabindex=\"0\">'+strings.cancel_button_text+'</div>');\r\n                \r\n                buttons.append(postbutton);\r\n                buttons.append(cancelbutton);\r\n                \r\n                if (mediaSelection==MEDIA_SELECTION_BUTTONS) {\r\n                    buttons.append('<div class=\"spacer_button\"></div>');\r\n                    var ytButton = $('<div class=\"attachment_button youtube_button action_button fa '+attachmentFAIcons[0]+'\" role=\"button\" aria-label=\"'+strings.aria_addmedia.replace('{type}', strings.option_youtube)+'\" tabindex=\"0\"></div>');\r\n                    ytButton.on('click', function() { attachmentType.val(1); attachmentType.trigger(\"change\"); });\r\n                    var imgButton = $('<div class=\"attachment_button image_button action_button fa '+attachmentFAIcons[1]+'\" role=\"button\" aria-label=\"'+strings.aria_addmedia.replace('{type}', strings.option_image)+'\" tabindex=\"0\"></div>');\r\n                    imgButton.on('click', function() { attachmentType.val(2); attachmentType.trigger(\"change\"); });\r\n                    var linkButton = $('<div class=\"attachment_button link_button action_button fa '+attachmentFAIcons[2]+'\" role=\"button\" aria-label=\"'+strings.aria_addmedia.replace('{type}', strings.option_link)+'\" tabindex=\"0\"></div>');\r\n                    linkButton.on('click', function() { attachmentType.val(3); attachmentType.trigger(\"change\"); });\r\n                    buttons.append(ytButton);\r\n                    buttons.append(imgButton);\r\n                    buttons.append(linkButton);\r\n                }\r\n                \r\n                note.append(buttons);\r\n                \r\n                var removeElement = $('<div class=\"remove fa fa-remove\" role=\"button\" aria-label=\"'+strings.aria_deletepost.replace('{column}', column_name.text()).replace('{post}', noteHeading.text())+'\" tabindex=\"0\"></div>');\r\n                removeElement.on('click keypress', function(e) {\r\n                    if (e.type=='keypress') {\r\n                        if (isAriaTriggerKey(e.keyCode)) {\r\n                            e.preventDefault();\r\n                        } else {\r\n                            return;\r\n                        }\r\n                    }\r\n                    \r\n                    deleteNote(ident);\r\n                });\r\n                if (!ident) {\r\n                    removeElement.hide();\r\n                }\r\n                notecontent.append(removeElement);\r\n                \r\n                cancelbutton.on('click keypress', function(e) {\r\n                    if (e.type=='keypress') {\r\n                        if (isAriaTriggerKey(e.keyCode)) {\r\n                            e.preventDefault();\r\n                        } else {\r\n                            return;\r\n                        }\r\n                    }\r\n                    \r\n                    stopNoteEdit();\r\n                });\r\n                \r\n                noteText.on('click', function(e) {\r\n                    if ((editingNote && editingNote==ident) || !ident) {\r\n                        noteText.editable('open');\r\n                    }\r\n                });\r\n                \r\n                var beginEdit = function() {\r\n                    startNoteEdit(ident);\r\n                };\r\n                \r\n                noteText.on('dblclick keypress', function(e) {\r\n                    if (e.type=='keypress') {\r\n                        if (isAriaTriggerKey(e.keyCode) && !noteText.is(':editing')) {\r\n                            e.preventDefault();\r\n                            noteText.dblclick();\r\n                            return;\r\n                        } else {\r\n                            return;\r\n                        }\r\n                    }\r\n                    \r\n                    beginEdit();\r\n                });\r\n                \r\n                noteHeading.on('click', function(e) {\r\n                    if ((editingNote && editingNote==ident) || !ident) {\r\n                        noteHeading.editable('open');\r\n                    }\r\n                });\r\n                \r\n                noteHeading.on('dblclick keypress', function(e) {\r\n                    if (e.type=='keypress') {\r\n                        if (isAriaTriggerKey(e.keyCode) && !noteHeading.is(':editing')) {\r\n                            e.preventDefault();\r\n                            noteHeading.dblclick();\r\n                            return;\r\n                        } else {\r\n                            return;\r\n                        }\r\n                    }\r\n                    \r\n                    beginEdit();\r\n                });\r\n                \r\n                attachmentPreview.on('dblclick', function() {\r\n                    beginEdit();\r\n                });\r\n                \r\n                postbutton.on('click keypress', function(e) {\r\n                    if (e.type=='keypress') {\r\n                        if (isAriaTriggerKey(e.keyCode)) {\r\n                            e.preventDefault();\r\n                        } else {\r\n                            return;\r\n                        }\r\n                    }\r\n                    \r\n                    var sendAttach = attachmentDataForNote(note);\r\n                    \r\n                    if (!ident) { // new\r\n                        var addHeading = noteHeading.html();\r\n                        var addText = noteText.html();\r\n                        \r\n                        serviceCall('add_note', {columnid: columnid, heading: addHeading, content: addText, attachment: sendAttach}, function(result) {\r\n                            lastHistoryId = result.historyid;\r\n                            \r\n                            note.remove();\r\n                            showNewNoteButtons();\r\n                            addNote(columnid, result.id, addHeading, addText, sendAttach, {id: userId});\r\n                            sortNotes(column_content);\r\n                        });\r\n                        \r\n                    } else { // update\r\n                        serviceCall('update_note', {id: ident, heading: noteHeading.html(), content: noteText.html(), attachment: sendAttach}, function(result) {\r\n                            if (result.status) {\r\n                                setAttachment(note, sendAttach);\r\n                                successNoteEdit();\r\n                                lastHistoryId = result.historyid;\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n                \r\n                noteText.editable({\r\n                    toggleFontSize : false,\r\n                    closeOnEnter: false,\r\n                    /*\r\n                    callback : function( data ) {\r\n                        if (!ident && !noteText.html()) { // hide new note if empty\r\n                            note.remove();\r\n                            showNewNoteButtons();\r\n                        }\r\n                    }\r\n                    */\r\n                });\r\n                \r\n                noteHeading.editable({\r\n                    toggleFontSize : false,\r\n                    closeOnEnter: true\r\n                });\r\n                \r\n                setAttachment(note, attachment);\r\n            } else {\r\n                previewAttachment(note, attachment);\r\n            }\r\n            \r\n            if (ident) {\r\n                if (!noteHeading.html()) {\r\n                    noteHeading.hide();\r\n                }\r\n                var lastOne = column_content.find(\".board_note\").last();\r\n                if (lastOne.length) {\r\n                    note.insertAfter(lastOne);\r\n                } else {\r\n                    column_content.prepend(note);\r\n                }\r\n            } else {\r\n                $('.board_column[data-ident='+columnid+'] .board_column_newcontent').append(note);\r\n                noteText.dblclick() // trigger edit of note\r\n            }\r\n        };\r\n        \r\n        var addColumn = function(ident, name, notes, sort) {\r\n            var iseditable = isEditor;\r\n            var nameCache = null;\r\n            var column = $('<div class=\"board_column board_column_hasdata\" data-ident=\"'+ident+'\"></div>');\r\n            var column_header = $('<div class=\"board_column_header\"></div>');\r\n            var column_sort = $('<div class=\"column_sort fa\"></div>');\r\n            var column_name = $('<div class=\"column_name\" tabindex=\"0\" aria-level=\"3\" role=\"heading\">'+name+'</div>');\r\n            var column_content = $('<div class=\"board_column_content\"></div>');\r\n            var column_newcontent = $('<div class=\"board_column_newcontent\"></div>');\r\n            column_header.append(column_sort);\r\n            column_header.append(column_name);\r\n            \r\n            column_sort.on('click', function() {\r\n                sortNotes(column_content, true);\r\n            });\r\n            \r\n            if (iseditable) {\r\n                column.addClass('editablecolumn');\r\n\r\n                var removeElement = $('<div class=\"remove fa fa-remove\" role=\"button\" aria-label=\"'+strings.aria_deletecolumn.replace('{column}', column_name.text())+'\" tabindex=\"0\"></div>');\r\n                removeElement.on('click keypress', function(e) {\r\n                    if (e.type=='keypress') {\r\n                        if (isAriaTriggerKey(e.keyCode)) {\r\n                            e.preventDefault();\r\n                        } else {\r\n                            return;\r\n                        }\r\n                    }\r\n                    \r\n                    if (confirm(strings.remove_column_text)) {\r\n                        serviceCall('delete_column', {id: ident}, function(result) {\r\n                            if (result.status) {\r\n                                column.remove();\r\n                                lastHistoryId = result.historyid;\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n                \r\n                column_header.append(removeElement);\r\n            }\r\n            \r\n            column.append(column_header);\r\n            column.append(column_content);\r\n            column.append(column_newcontent);\r\n            \r\n            if (iseditable) {\r\n                column_name.on('dblclick keypress', function(e) {\r\n                    if (e.type=='keypress') {\r\n                        if (isAriaTriggerKey(e.keyCode) && !column_name.is(':editing')) {\r\n                            e.preventDefault();\r\n                            column_name.dblclick();\r\n                        } else {\r\n                            return;\r\n                        }\r\n                    }\r\n                    \r\n                    nameCache = column_name.html();\r\n                });\r\n                \r\n                column_name.editable({\r\n                    toggleFontSize : false,\r\n                    closeOnEnter: true,\r\n                    callback : function( data ) {\r\n                        if ( data.content ) {\r\n                            serviceCall('update_column', {id: ident, name: column_name.html()}, function(result) {\r\n                                if (!result.status) {\r\n                                    column_name.html(nameCache);\r\n                                    nameCache = null;\r\n                                } else {\r\n                                    lastHistoryId = result.historyid;\r\n                                }\r\n                            }, function() {\r\n                                column_name.html(nameCache);\r\n                                nameCache = null;\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (!isReadOnlyBoard) {\r\n                column_newcontent.append('<div class=\"board_button newnote\" role=\"button\" aria-label=\"'+strings.aria_newpost.replace('{column}', column_name.text())+'\" tabindex=\"0\"><div class=\"button_content\"><span class=\"fa '+options.noteicon+'\"></span></div></div>');\r\n                column_newcontent.on('click keypress', '.newnote', function(e) {\r\n                    if (e.type=='keypress') {\r\n                        if (isAriaTriggerKey(e.keyCode)) {\r\n                            e.preventDefault();\r\n                        } else {\r\n                            return;\r\n                        }\r\n                    }\r\n                    \r\n                    addNote(ident, 0, null, null, null, {id: userId});\r\n                });\r\n            }\r\n\r\n            var lastOne = $(\".mod_board .board_column_hasdata\").last();\r\n            if (lastOne.length) {\r\n                column.insertAfter(lastOne);\r\n            } else {\r\n                $(\".mod_board\").append(column);\r\n            }\r\n                        \r\n            if (notes) {\r\n                for (index in notes) {\r\n                    addNote(ident, notes[index].id, notes[index].heading, notes[index].content, {type: notes[index].type, info: notes[index].info, url: notes[index].url}, {id: notes[index].userid});\r\n                }\r\n            }\r\n            sortNotes(column_content, true);\r\n        };\r\n        \r\n        var addNewColumnButton = function() {\r\n            var column = $('<div class=\"board_column board_column_empty\"></div>');\r\n            var newBusy = false;\r\n            column.append('<div class=\"board_button newcolumn\" role=\"button\" tabindex=\"0\" aria-label=\"'+strings.aria_newcolumn+'\"><div class=\"button_content\"><span class=\"fa '+options.columnicon+'\"></span></div></div>');\r\n            column.on('click keypress', '.newcolumn', function(e) {\r\n                if (newBusy) {\r\n                    return;\r\n                }\r\n                newBusy = true;\r\n                if (e.type=='keypress') {\r\n                    if (isAriaTriggerKey(e.keyCode)) {\r\n                        e.preventDefault();\r\n                    } else {\r\n                        return;\r\n                    }\r\n                }\r\n                \r\n                serviceCall('add_column', {boardid: board.id, name: strings.default_column_heading}, function(result) {\r\n                    addColumn(result.id, strings.default_column_heading);\r\n                    lastHistoryId = result.historyid;\r\n                    newBusy = false;\r\n                }, function(error) {\r\n                    newBusy = false;\r\n                });\r\n            });\r\n            \r\n            $(\".mod_board\").append(column);\r\n        };\r\n        \r\n        var processBoardHistory = function() {\r\n            serviceCall('board_history', {id: board.id, since: lastHistoryId}, function(boardhistory) {\r\n                for (index in boardhistory) {\r\n                    var item = boardhistory[index];\r\n                    if (item.boardid!=board.id) {\r\n                        continue; // hmm\r\n                    }\r\n                    \r\n                    var data = JSON.parse(item.content);\r\n                    if (item.action=='add_note') {\r\n                        addNote(data.columnid, data.id, data.heading, data.content, data.attachment, {id: item.userid});\r\n                    } else if (item.action=='update_note') {\r\n                        var note = getNote(data.id);\r\n                        if (note) {\r\n                            var heading = getNoteHeadingForNote(note);\r\n                            \r\n                            var updateNote = function() {\r\n                                heading.html(data.heading);\r\n                                if (data.heading) {\r\n                                    heading.show();\r\n                                } else {\r\n                                    heading.hide();\r\n                                }\r\n                                getNoteTextForNote(note).html(data.content);\r\n                                setAttachment(note, data.attachment);\r\n                                noteTextCache = null;\r\n                                noteHeadingCache = null;\r\n                                attachmentCache = null;\r\n                            };\r\n                            \r\n                            if (editingNote==data.id) {\r\n                                Notification.confirm(\r\n                                    strings.note_changed_text.split(\"\\n\")[0], // Confirm.\r\n                                    strings.note_changed_text.split(\"\\n\")[1], // Are you sure?\r\n                                    strings.Ok,\r\n                                    strings.Cancel,\r\n                                    function() {\r\n                                        if (editingNote==data.id) {\r\n                                            updateNote();\r\n                                        }\r\n                                        stopNoteEdit();\r\n                                    }\r\n                                );\r\n                            } else {\r\n                                updateNote();\r\n                            }\r\n                        }\r\n                    } else if (item.action=='delete_note') {\r\n                        if (editingNote==data.id) {\r\n                            Notification.alert(strings.warning, strings.note_deleted_text);\r\n                            stopNoteEdit();\r\n                        }\r\n                        getNote(data.id).remove();\r\n                        \r\n                    } else if (item.action=='add_column') {\r\n                        addColumn(data.id, data.name);\r\n                    } else if (item.action=='update_column') {\r\n                        $(\".board_column[data-ident='\"+data.id+\"'] .column_name\").html(data.name);\r\n                    } else if (item.action=='delete_column') {\r\n                        var column = $(\".board_column[data-ident='\"+data.id+\"']\");\r\n                        if (editingNote && column.find('.board_note[data-ident=\"'+editingNote+'\"]').length) {\r\n                            stopNoteEdit();\r\n                        }\r\n                        column.remove();\r\n                    }\r\n                    lastHistoryId = item.id;\r\n                }\r\n                \r\n                updateBoard();\r\n            });\r\n        };\r\n        \r\n        var updateBoard = function(instant) {\r\n            if (instant) {\r\n                processBoardHistory();\r\n            } else {\r\n                if (reloadTimer) {\r\n                    stopUpdating();\r\n                }\r\n                reloadTimer = setTimeout(processBoardHistory, 2000);\r\n            }\r\n        };\r\n        \r\n        var stopUpdating = function() {\r\n            clearTimeout(reloadTimer);\r\n            reloadTimer = null;\r\n        };\r\n        \r\n        var sortNotes = function(content, toggle) {\r\n            var sort_col = $(content).parent().find('.column_sort');\r\n            var direction = $(content).data('sort');\r\n            if (toggle) {\r\n                direction = direction=='asc'?'desc':'asc';\r\n            }\r\n            \r\n            if (direction=='asc') {\r\n                sort_col.removeClass('fa-angle-down');\r\n                sort_col.addClass('fa-angle-up');\r\n            } else {\r\n                sort_col.removeClass('fa-angle-up');\r\n                sort_col.addClass('fa-angle-down');\r\n            }\r\n            $(content).data('sort', direction);\r\n            \r\n            $('> .board_note', $(content)).sort(direction=='asc'?asc:desc).appendTo($(content));\r\n            function desc(a, b) { return $(b).data(\"ident\") < $(a).data(\"ident\") ? -1 : 1; }\r\n            function asc(a, b) { return $(b).data(\"ident\") < $(a).data(\"ident\") ? 1 : -1; }\r\n        };\r\n        \r\n        var init = function() {\r\n            serviceCall('get_board', {id: board.id}, function(columns) {\r\n                // init\r\n                if (columns) {\r\n                    for (index in columns) {\r\n                        addColumn(columns[index].id, columns[index].name, columns[index].notes || {});\r\n                    }\r\n                }\r\n                if (isEditor) {\r\n                    addNewColumnButton();\r\n                }\r\n                \r\n                lastHistoryId = board.historyid;\r\n            });\r\n        };\r\n   \r\n        // get strings\r\n        var stringsInfo = [];\r\n        for (string in strings) {\r\n            stringsInfo.push({key: string, component: 'mod_board'});\r\n        }\r\n                \r\n        $.when(Str.get_strings(stringsInfo)).done(function(results) {\r\n            var index = 0;\r\n            for (string in strings) {\r\n                strings[string] = results[index++];\r\n            }\r\n            \r\n            init();\r\n        });\r\n    };\r\n});"],"file":"board.min.js"}