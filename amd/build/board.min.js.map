{"version":3,"sources":["../src/board.js"],"names":["_serviceCall","method","args","callback","failcallback","Ajax","call","methodname","done","data","fail","error","Notification","exception","isAriaTriggerKey","key","encodeText","rawText","text","html","decodeText","encodedText","handleAction","elem","on","e","type","keyCode","preventDefault","handleEditableAction","callBeforeOnKeyEditing","is","Error","editable","board","options","contextid","strings","default_column_heading","post_button_text","cancel_button_text","remove_note_text","remove_column_text","note_changed_text","note_deleted_text","rate_note_text","Ok","Cancel","warning","modal_title_new","modal_title_edit","aria_newcolumn","aria_newpost","aria_deletecolumn","aria_deletepost","aria_addmedia","aria_addmedianew","aria_deleteattachment","aria_postedit","aria_canceledit","aria_postnew","aria_cancelnew","aria_choosefilenew","aria_choosefileedit","aria_ratepost","invalid_file_extension","invalid_file_size_min","invalid_file_size_max","MEDIA_SELECTION_BUTTONS","ATTACHMENT_IMAGE","SORTBY_DATE","SORTBY_RATING","reloadTimer","lastHistoryId","isEditor","userId","mediaSelection","mediaselection","editingNote","isReadOnlyBoard","readonly","ratingenabled","sortby","serviceCall","stopUpdating","apply","arguments","updateBoard","getNote","ident","getNoteTextForNote","note","find","getNoteHeadingForNote","getNoteBorderForNote","getNoteButtonsForNote","showNewNoteButtons","show","hideNewNoteButtons","hide","getNoteAttachmentsForNote","textIdentifierForNote","noteText","noteHeading","noteAttachment","attachmentDataForNote","length","replace","split","slice","join","info","updateNoteAria","noteId","columnIdentifier","closest","noteIdentifier","attr","updateColumnAria","columnId","column","each","index","stopNoteEdit","remove","noteBorder","startNoteEdit","pendingNote","showModalForm","deleteNote","confirm","id","result","status","historyid","rateNote","rating","canrate","sortNotes","attachmentTypeChanged","val","attachmentInfo","attachmentUrl","attachmentFile","attachmentIcon","removeAttachment","prop","attachmentTypeToString","FileReader","removeClass","addClass","attachmentFAIcon","setAttachment","attachment","attType","url","previewAttachment","filename","filecontents","fileElem","attachmentFAIcons","fixEmbedUrlIfNeeded","parseInt","addNote","columnid","heading","content","owner","sortorder","ismynote","iseditable","notecontent","noteAriaText","attachmentPreview","append","columnContent","removeElement","beginEdit","rateElement","lastOne","last","insertAfter","prepend","addColumn","name","notes","nameCache","columnHeader","columnSort","columnName","columnNewContent","hideheaders","toggleFontSize","closeOnEnter","noteicon","userid","timecreated","updateSortable","addNewColumnButton","newBusy","columnicon","boardid","updateNote","processBoardHistory","since","boardhistory","item","JSON","parse","action","alert","instant","history_refresh","setTimeout","clearTimeout","toggle","sortCol","parent","direction","desc","asc","a","b","sort","appendTo","sortable","connectWith","stop","ui","tocolumn","getBody","noteid","Fragment","loadFragment","title","ModalFactory","create","types","SAVE_CANCEL","body","large","removeOnClose","then","modal","getBodyPromise","setLarge","setSaveButtonText","setButtonText","getRoot","ModalEvents","hidden","save","submit","changeEvent","document","createEvent","initEvent","element","dispatchEvent","invalid","$","merge","first","focus","formData","stringify","serialize","jsonformdata","Y","use","M","core_formchangechecker","reset_form_dirty_state","mediaSelect","ytButton","pictureButton","linkButton","updateMediaButtons","init","columns","stringsInfo","string","push","component","when","results"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to handle the board.\n *\n * @package    mod_board\n * @author     Karen Holland <karen@brickfieldlabs.ie>\n * @copyrigt   2021 Brickfield Education Labs <https://www.brickfield.ie/>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from \"jquery\";\nimport \"jqueryui\";\nimport {get_strings as getStrings} from \"core/str\";\nimport Ajax from \"core/ajax\";\nimport ModalFactory from \"core/modal_factory\";\nimport ModalEvents from \"core/modal_events\";\nimport Notification from \"core/notification\";\nimport \"mod_board/jquery.editable.amd\";\nimport Fragment from \"core/fragment\";\n\n/**\n * Execute a ajax call to a mod_board ajax service.\n *\n * @method _serviceCall\n * @param method\n * @param args\n * @param callback\n * @param failcallback\n * @private\n */\nconst _serviceCall = function(method, args, callback, failcallback) {\n    Ajax.call([{\n        methodname: 'mod_board_' + method,\n        args: args,\n        done: function(data) {\n            callback(data);\n        },\n        fail: function(error) {\n            Notification.exception(error);\n            if (failcallback) {\n                failcallback(error);\n            }\n        }\n    }]);\n};\n\n/**\n * Indicates if this is a keycode we want to listend to for\n * aria purposes.\n *\n * @method isAriaTriggerKey\n * @param key\n * @returns {boolean}\n */\nconst isAriaTriggerKey = function(key) {\n    return key == 13 || key == 32;\n};\n\n/**\n * Encodes text into html entities.\n *\n * @method encodeText\n * @param rawText\n * @returns {*|jQuery}\n */\nconst encodeText = function(rawText) {\n    return $('<div />').text(rawText).html();\n};\n\n/**\n * Decodes text from html entities.\n *\n * @method decodeText\n * @param encodedText\n * @returns {*|jQuery}\n */\nconst decodeText = function(encodedText) {\n    return $('<div />').html(encodedText).text();\n};\n\n/**\n * Handler for keypress and click actions.\n *\n * $method handleAction\n * @param elem\n * @param callback\n * @returns {*}\n */\nconst handleAction = function(elem, callback) {\n    return elem.on('click keypress', function(e) {\n        if (e.type == 'keypress') {\n            if (isAriaTriggerKey(e.keyCode)) {\n                e.preventDefault();\n            } else {\n                return;\n            }\n        }\n\n        callback();\n    });\n};\n\n/**\n * Setting up element edibility.\n *\n * @method handleEditableAction\n * @param elem\n * @param callback\n * @param callBeforeOnKeyEditing\n * @returns {*}\n */\nconst handleEditableAction = function(elem, callback, callBeforeOnKeyEditing) {\n    if (elem.is(':editable')) {\n        throw new Error('handleEditableAction - must be called before setting the element as editable');\n    }\n\n    // Can't use on(edit) here because we want to do actions (save cache) before the control goes into edit mode\n    return elem.on('dblclick keypress', function(e) {\n        if (e.type == 'keypress') {\n            if (isAriaTriggerKey(e.keyCode) && !elem.is(':editing')) {\n                e.preventDefault();\n                if (callBeforeOnKeyEditing) {\n                    callback();\n                }\n                elem.editable('open');\n                if (callBeforeOnKeyEditing) {\n                    return;\n                }\n            } else {\n                return;\n            }\n        }\n\n        callback();\n    });\n};\n\n/**\n * The default function of the module, which does the setup of the page.\n *\n * @param board\n * @param options\n * @param contextid\n */\nexport default function(board, options, contextid) {\n    // An array of strings to load as a batch later.\n    // Not necessary, but used to load all the strings in one ajax call.\n    var strings = {\n        default_column_heading: '',\n        post_button_text: '',\n        cancel_button_text: '',\n        remove_note_text: '',\n        remove_column_text: '',\n        note_changed_text: '',\n        note_deleted_text: '',\n        rate_note_text: '',\n        Ok: '',\n        Cancel: '',\n        warning: '',\n        modal_title_new: '',\n        modal_title_edit: '',\n\n        aria_newcolumn: '',\n        aria_newpost: '',\n        aria_deletecolumn: '',\n        aria_deletepost: '',\n        aria_addmedia: '',\n        aria_addmedianew: '',\n        aria_deleteattachment: '',\n        aria_postedit: '',\n        aria_canceledit: '',\n        aria_postnew: '',\n        aria_cancelnew: '',\n        aria_choosefilenew: '',\n        aria_choosefileedit: '',\n        aria_ratepost: '',\n\n        invalid_file_extension: '',\n        invalid_file_size_min: '',\n        invalid_file_size_max: '',\n    };\n\n    const MEDIA_SELECTION_BUTTONS = 1,\n          ATTACHMENT_VIDEO = 1,\n          ATTACHMENT_IMAGE = 2,\n          ATTACHMENT_LINK = 3,\n          SORTBY_DATE = 1,\n          SORTBY_RATING = 2;\n    var reloadTimer = null,\n        lastHistoryId = null,\n        isEditor = options.isEditor || false,\n        userId = options.userId || -1,\n        mediaSelection = options.mediaselection || MEDIA_SELECTION_BUTTONS,\n        editingNote = 0,\n        isReadOnlyBoard = options.readonly || false,\n        ratingenabled = options.ratingenabled,\n        sortby = options.sortby || SORTBY_DATE;\n    /**\n     * Helper method to make calles to mod_board external services.\n     *\n     * @method serviceCall\n     * @param method\n     * @param args\n     * @param callback\n     * @param failcallback\n     */\n    var serviceCall = function(method, args, callback, failcallback) {\n        if (method !== 'board_history') {\n            stopUpdating();\n        }\n        _serviceCall(method, args, function() {\n            callback.apply(null, arguments);\n            if (method !== 'board_history' && method != 'get_board') {\n                updateBoard(true);\n            }\n        }, failcallback);\n    };\n\n    /**\n     * Returns the jquery element of a given note identifier.\n     *\n     * @method getNote\n     * @param ident\n     * @returns {jQuery|HTMLElement|*}\n     */\n    var getNote = function(ident) {\n        return $(\".board_note[data-ident='\" + ident + \"']\");\n    };\n\n    /**\n     * Returns the jquery element of the note text for the given note element.\n     *\n     * @method getNoteTextForNote\n     * @param note\n     * @returns {*|jQuery}\n     */\n    var getNoteTextForNote = function(note) {\n        return $(note).find(\".mod_board_note_text\");\n    };\n\n    /**\n     * Returns the jquery element of the note heading for the given note element.\n     *\n     * @method getNoteHeadingForNote\n     * @param note\n     * @returns {*|jQuery}\n     */\n    var getNoteHeadingForNote = function(note) {\n        return $(note).find(\".mod_board_note_heading\");\n    };\n\n    /**\n     * Returns the jquery element of the note border for the given note element.\n     *\n     * @method getNoteBorderForNote\n     * @param note\n     * @returns {*|jQuery}\n     */\n    var getNoteBorderForNote = function(note) {\n        return $(note).find(\".mod_board_note_border\");\n    };\n\n    /**\n     * Returns the jquery element of the note buttons for the given note element.\n     *\n     * @method getNoteButtonsForNote\n     * @param note\n     * @returns {*|jQuery}\n     */\n    var getNoteButtonsForNote = function(note) {\n        return $(note).find(\".mod_board_note_buttons\");\n    };\n\n    /**\n     * Shows the buttons creation new notes.\n     *\n     * @method showNewNoteButtons\n     */\n    var showNewNoteButtons = function() {\n        $('.board_column .board_column_newcontent .board_button.newnote').show();\n    };\n\n    /**\n     * Hides the buttons for creating new notes.\n     *\n     * @method hideNewNoteButtons\n     */\n    var hideNewNoteButtons = function() {\n        $('.board_column .board_column_newcontent .board_button.newnote').hide();\n    };\n\n    /**\n     * Gets a jquery node for the attachments of a given note.\n     *\n     * @method getNoteAttachmentsForNote\n     * @param note\n     * @returns {*|jQuery}\n     */\n    var getNoteAttachmentsForNote = function(note) {\n        return $(note).find(\".mod_board_note_attachment\");\n    };\n\n    /**\n     * Creates text identifier for a given node.\n     *\n     * @method textIdentifierForNote\n     * @param note\n     * @returns {null|*|jQuery}\n     */\n    var textIdentifierForNote = function(note) {\n        var noteText = getNoteTextForNote(note).html(),\n            noteHeading = getNoteHeadingForNote(note).html(),\n            noteAttachment = attachmentDataForNote(note);\n\n        if (noteHeading.length > 0) {\n            return noteHeading;\n        }\n        if (noteText.length > 0) {\n            return noteText.replace(/<br\\s*\\/?>/gi, \" \").replace(/\\n/g, \" \").split(/\\s+/).slice(0, 5).join(\" \");\n        }\n        if (noteAttachment.info && noteAttachment.info.length > 0) {\n            return noteAttachment.info;\n        }\n        return null;\n    };\n\n    /**\n     * Update the Aria info for a given note id.\n     *\n     * @method updateNoteAria\n     * @param noteId\n     */\n    var updateNoteAria = function(noteId) {\n        var note = getNote(noteId),\n            columnIdentifier = note.closest('.board_column').find('.mod_board_column_name').text();\n\n        if (noteId) { // New post\n            var noteIdentifier = textIdentifierForNote(note);\n\n            note.find('.delete_note').attr('aria-label', strings.aria_deletepost.replace('{column}',\n                columnIdentifier).replace('{post}', noteIdentifier));\n            note.find('.mod_board_rating').attr('aria-label', strings.aria_ratepost.replace('{column}',\n                columnIdentifier).replace('{post}', noteIdentifier));\n            note.find('.note_ariatext').html(noteIdentifier);\n        }\n\n    };\n\n    /**\n     * Update the Aria information for a given column id.\n     *\n     * @method updateColumnAria\n     * @param columnId\n     */\n    var updateColumnAria = function(columnId) {\n        var column = $('.board_column[data-ident=' + columnId + ']'),\n            columnIdentifier = column.find('.mod_board_column_name').text();\n        column.find('.newnote').attr('aria-label', strings.aria_newpost.replace('{column}', columnIdentifier));\n        column.find('.delete_column').attr('aria-label', strings.aria_deletecolumn.replace('{column}', columnIdentifier));\n\n        column.find(\".board_note\").each(function(index, note) {\n            updateNoteAria($(note).data('ident'));\n        });\n    };\n\n    /**\n     * Stop the current note editing process.\n     *\n     * @method stopNoteEdit\n     */\n    var stopNoteEdit = function() {\n        if (!editingNote) {\n            getNote(0).remove();\n            showNewNoteButtons();\n            return;\n        }\n\n        var note = getNote(editingNote);\n\n        if (note) {\n            showNewNoteButtons();\n            var noteHeading = getNoteHeadingForNote(note);\n            var noteText = getNoteTextForNote(note);\n            var noteBorder = getNoteBorderForNote(note);\n            if (!noteHeading.html()) {\n                noteHeading.hide();\n                noteBorder.hide();\n            }\n            if (!noteText.html() && noteHeading.html()) {\n                noteText.hide();\n                noteBorder.hide();\n            }\n        }\n\n        editingNote = 0;\n    };\n\n    /**\n     * Start the editing of a particular note, by identifier.\n     *\n     * @method startNoteEdit\n     * @param ident\n     */\n    var startNoteEdit = function(ident) {\n\n        if (editingNote) {\n            if (editingNote == ident) {\n                return;\n            }\n            stopNoteEdit();\n        }\n\n        if (ident) {\n            var pendingNote = getNote(0);\n            if (pendingNote) {\n                pendingNote.remove();\n            }\n        }\n\n        var note = getNote(ident);\n        if (note) {\n            showModalForm(note);\n            hideNewNoteButtons();\n\n            if (ident) {\n                editingNote = ident;\n            }\n        }\n    };\n\n    /**\n     * Delete a given note, by identifier.\n     *\n     * @method deleteNote\n     * @param ident\n     */\n    var deleteNote = function(ident) {\n        Notification.confirm(\n            strings.remove_note_text.split(\"\\n\")[1], // Are you sure?\n            strings.remove_note_text.split(\"\\n\")[0], // This will effect others.\n            strings.Ok,\n            strings.Cancel,\n            function() {\n                serviceCall('delete_note', {id: ident}, function(result) {\n                    if (result.status) {\n                        lastHistoryId = result.historyid;\n                        getNote(ident).remove();\n                    }\n                });\n            }\n        );\n    };\n\n    /**\n     * Rate (star) a give note, by identifier.\n     *\n     * @method rateNote\n     * @param ident\n     */\n    var rateNote = function(ident) {\n        if (!ratingenabled) {\n            return;\n        }\n        if (isReadOnlyBoard) {\n            return;\n        }\n\n        var note = getNote(ident),\n            rating = note.find('.mod_board_rating');\n        if (rating.data('disabled')) {\n            return;\n        }\n        rating.data('disabled', true);\n\n        serviceCall('can_rate_note', {id: ident}, function(canrate) {\n            if (canrate) {\n                Notification.confirm(\n                    strings.rate_note_text, // Are you sure?\n                    null,\n                    strings.Ok,\n                    strings.Cancel,\n                    function() {\n                        serviceCall('rate_note', {id: ident}, function(result) {\n                            if (result.status) {\n                                lastHistoryId = result.historyid;\n                                rating.html(result.rating);\n                                if (sortby == SORTBY_RATING) {\n                                    sortNotes(note.closest('.board_column_content'));\n                                }\n                            }\n                            rating.data('disabled', false);\n                        });\n                    }\n                );\n\n            }\n        });\n    };\n\n    /**\n     * Update the attachment information of a note.\n     *\n     * @method attachmentTypeChanged\n     * @param note\n     */\n    var attachmentTypeChanged = function(note) {\n        var noteAttachment = getNoteAttachmentsForNote(note),\n            type = noteAttachment.find('.mod_board_type').val(),\n            attachmentInfo = noteAttachment.find('.info'),\n            attachmentUrl = noteAttachment.find('.url'),\n            attachmentFile = noteAttachment.find('.mod_board_file');\n\n        if (mediaSelection == MEDIA_SELECTION_BUTTONS) {\n            var attachmentIcon = noteAttachment.find('.mod_board_type_icon'),\n                removeAttachment = noteAttachment.find('.mod_board_remove_attachment');\n        } else {\n            getNoteButtonsForNote(note).find('.mod_board_attachment_button').hide();\n        }\n\n        if (type > \"0\") {\n            if (mediaSelection == MEDIA_SELECTION_BUTTONS) {\n                removeAttachment.show();\n            }\n            attachmentInfo.prop('placeholder', strings['option_' + attachmentTypeToString(type) + '_info']);\n            attachmentUrl.prop('placeholder', strings['option_' + attachmentTypeToString(type) + '_url']);\n\n            attachmentInfo.show();\n            if (type == ATTACHMENT_IMAGE && FileReader) {\n                attachmentFile.show();\n                attachmentUrl.hide();\n            } else {\n                attachmentFile.hide();\n                attachmentUrl.show();\n            }\n\n            if (mediaSelection == MEDIA_SELECTION_BUTTONS) {\n                attachmentIcon.removeClass().addClass(['mod_board_type_icon', 'fa', attachmentFAIcon(type)]);\n                attachmentIcon.show();\n                getNoteButtonsForNote(note).find('.mod_board_attachment_button').hide();\n            }\n        } else {\n            if (mediaSelection == MEDIA_SELECTION_BUTTONS) {\n                removeAttachment.hide();\n            }\n            attachmentInfo.hide();\n            attachmentUrl.hide();\n            attachmentFile.hide();\n            if (mediaSelection == MEDIA_SELECTION_BUTTONS) {\n                attachmentIcon.hide();\n            }\n            attachmentInfo.val('');\n            attachmentUrl.val('');\n            if (mediaSelection == MEDIA_SELECTION_BUTTONS) {\n                getNoteButtonsForNote(note).find('.mod_board_attachment_button').show();\n            }\n        }\n    };\n\n    /**\n     * Set the attachment of a note.\n     *\n     * @method setAttachment\n     * @param note\n     * @param attachment\n     */\n    var setAttachment = function(note, attachment) {\n        var noteAttachment = getNoteAttachmentsForNote(note);\n        if (noteAttachment) {\n            if (!attachment) {\n                attachment = {type: \"0\"};\n            } else {\n                attachment.type += \"\";// Just in case\n            }\n            var attType = noteAttachment.find('.mod_board_type');\n            attType.val(attachment.type ? attachment.type : \"0\");\n            if (attType.val() > \"0\") {\n                noteAttachment.find('.info').val(decodeText(attachment.info));\n                noteAttachment.find('.url').val(decodeText(attachment.url));\n            }\n            attachmentTypeChanged(note, attachment);\n        }\n        previewAttachment(note, attachment);\n    };\n\n    /**\n     * Returns an object with various information about a note's attachment.\n     *\n     * @method attachmentDataForNote\n     * @param note\n     * @returns {{filename: null, filecontents: null, type: number, url: null, info: null}}\n     */\n    var attachmentDataForNote = function(note) {\n        var attachment = {type: 0, info: null, url: null, filename: null, filecontents: null},\n            noteAttachment = getNoteAttachmentsForNote(note);\n        if (noteAttachment.length) {\n            attachment.type = noteAttachment.find('.mod_board_type').val();\n            attachment.info = encodeText(noteAttachment.find('.info').val());\n            attachment.url = encodeText(noteAttachment.find('.url').val());\n            var fileElem = noteAttachment.find('.mod_board_file>input');\n            if (fileElem.data('filename')) {\n                attachment.filename = fileElem.data('filename');\n                attachment.filecontents = fileElem.data('filecontents');\n            }\n        }\n        if ((!attachment.info || !attachment.info.length) && (!attachment.url || !attachment.url.length) &&\n            (!attachment.filename)) {\n            attachment.type = 0;\n        }\n\n        return attachment;\n    };\n\n    /**\n     * Get the string type of a attachment type number.\n     *\n     * @method attachmentTypeToString\n     * @param type\n     * @returns {string|null}\n     */\n    var attachmentTypeToString = function(type) {\n        switch (type) {\n            case \"1\": return 'youtube';\n            case \"2\": return 'image';\n            case \"3\": return 'link';\n            default: return null;\n        }\n    };\n\n    var attachmentFAIcons = ['fa-youtube', 'fa-picture-o', 'fa-link'];\n    /**\n     * Get the fa icon for a given numeric attachment type.\n     *\n     * @method attachmentFAIcon\n     * @param type\n     * @returns {string|null}\n     */\n    var attachmentFAIcon = function(type) {\n        return attachmentFAIcons[type - 1] || null;\n    };\n\n    /**\n     * Display the attachment preview for a note.\n     *\n     * @method previewAttachment\n     * @param note\n     * @param attachment\n     */\n    var previewAttachment = function(note, attachment) {\n        var elem = note.find('.mod_board_preview');\n        if (!attachment) {\n            attachment = attachmentDataForNote(note);\n        }\n        var fixEmbedUrlIfNeeded = function(url) {\n            return url.replace(/watch\\?v=/gi, '/embed/').replace(/youtu\\.be/, 'youtube.com/embed');\n        };\n\n        if (!getNoteTextForNote(note).html().length) {\n            elem.addClass('mod_board_notext');\n        } else {\n            elem.removeClass('mod_board_notext');\n        }\n\n        elem.removeClass('wrapper_youtube');\n        elem.removeClass('wrapper_image');\n        elem.removeClass('wrapper_url');\n        if (attachment.filename && parseInt(attachment.type) == ATTACHMENT_IMAGE) { // Before uploading\n            elem.html('<img src=\"' + attachment.filecontents + '\" class=\"mod_board_preview_element\" alt=\"' +\n            attachment.info + '\"/>');\n            elem.addClass('wrapper_image');\n            elem.show();\n        } else if (attachment.url) {\n            switch (parseInt(attachment.type)) {\n                case ATTACHMENT_VIDEO: // Youtube\n                    elem.html('<iframe src=\"' + fixEmbedUrlIfNeeded(attachment.url) +\n                    '\" class=\"mod_board_preview_element\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write;' +\n                    'encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>');\n                    elem.addClass('wrapper_youtube');\n                    elem.show();\n                break;\n                case ATTACHMENT_IMAGE: // Image\n                    elem.html('<img src=\"' + attachment.url + '\" class=\"mod_board_preview_element\" alt=\"' +\n                    attachment.info + '\"/>');\n                    elem.addClass('wrapper_image');\n                    elem.show();\n                break;\n                case ATTACHMENT_LINK: // Url\n                    elem.html('<a href=\"' + attachment.url + '\" class=\"mod_board_preview_element\" target=\"_blank\">' +\n                             (attachment.info || attachment.url) + '</a>');\n                    elem.addClass('wrapper_url');\n                    elem.show();\n                break;\n                default:\n                    elem.html('');\n                    elem.hide();\n            }\n        } else {\n            elem.html('');\n            elem.hide();\n        }\n    };\n\n    /**\n     * Add a new note with the given information.\n     *\n     * @method addNote\n     * @param columnid\n     * @param ident\n     * @param heading\n     * @param content\n     * @param attachment\n     * @param owner\n     * @param sortorder\n     * @param rating\n     */\n    var addNote = function(columnid, ident, heading, content, attachment, owner, sortorder, rating) {\n        var ismynote = owner.id == userId || !ident;\n        var iseditable = isEditor || (ismynote && !isReadOnlyBoard);\n\n        if (!ident) {\n            var pendingNote = getNote(0);\n            if (pendingNote) {\n                pendingNote.remove();\n            }\n        }\n\n        var note = $('<div class=\"board_note\" data-column=\"' + columnid + '\" data-ident=\"' + ident +\n            '\" data-sortorder=\"' + sortorder + '\"></div>');\n        if (ismynote) {\n            note.addClass('mod_board_mynote');\n        }\n        if (iseditable) {\n            note.addClass('mod_board_editablenote');\n        }\n\n        var notecontent = $('<div class=\"mod_board_note_content\"></div>'),\n            noteHeading = $('<div class=\"mod_board_note_heading\" tabindex=\"0\">' + (heading ? heading : '') + '</div>'),\n            noteBorder = $('<div class=\"mod_board_note_border\"></div>'),\n            noteText = $('<div class=\"mod_board_note_text\" tabindex=\"0\">' + (content ? content : '') + '</div>'),\n            noteAriaText = $('<div class=\"note_ariatext hidden\" role=\"heading\" aria-level=\"4\" tabindex=\"0\"></div>'),\n            attachmentPreview = $('<div class=\"mod_board_preview\"></div>');\n\n        notecontent.append(noteHeading);\n        notecontent.append(noteBorder);\n        notecontent.append(noteText);\n        notecontent.append(noteAriaText);\n\n        notecontent.append(attachmentPreview);\n        note.append(notecontent);\n\n        var columnContent = $('.board_column[data-ident=' + columnid + '] .board_column_content');\n\n        if (iseditable) {\n            var removeElement = $('<div class=\"mod_board_remove fa fa-remove delete_note\" role=\"button\" tabindex=\"0\"></div>');\n            handleAction(removeElement, function() {\n                deleteNote(ident);\n            });\n\n            if (!ident) {\n                removeElement.hide();\n            }\n            notecontent.append(removeElement);\n\n            var beginEdit = function() {\n                startNoteEdit(ident);\n            };\n\n            note.on('dblclick', beginEdit);\n\n            handleEditableAction(noteBorder, beginEdit);\n\n            setAttachment(note, attachment);\n        } else {\n            previewAttachment(note, attachment);\n        }\n\n        if (ident) {\n            if (ratingenabled) {\n                note.addClass('mod_board_rateablenote');\n                var rateElement = $('<div class=\"fa fa-star mod_board_rating\" role=\"button\" tabindex=\"0\">' + rating + '</div>');\n\n                handleAction(rateElement, function() {\n                    rateNote(ident);\n                });\n                notecontent.append(rateElement);\n            }\n\n            if (!noteHeading.html()) {\n                noteHeading.hide();\n                noteBorder.hide();\n            }\n            if (!noteText.html() && noteHeading.html()) {\n                noteText.hide();\n                noteBorder.hide();\n            }\n\n            var lastOne = columnContent.find(\".board_note\").last();\n\n            if (lastOne.length) {\n                note.insertAfter(lastOne);\n            } else {\n                columnContent.prepend(note);\n            }\n        } else {\n            $('.board_column[data-ident=' + columnid + '] .board_column_newcontent').append(note);\n            updateNoteAria(ident);\n            noteText.editable('open'); // Trigger edit of note\n            beginEdit();\n        }\n    };\n\n    /**\n     * Add a new column.\n     *\n     * @method addColumn\n     * @param ident\n     * @param name\n     * @param notes\n     */\n    var addColumn = function(ident, name, notes) {\n        var iseditable = isEditor,\n            nameCache = null,\n            column = $('<div class=\"board_column board_column_hasdata\" data-ident=\"' + ident + '\"></div>'),\n            columnHeader = $('<div class=\"board_column_header\"></div>'),\n            columnSort = $('<div class=\"mod_board_column_sort fa\"></div>'),\n            columnName = $('<div class=\"mod_board_column_name\" tabindex=\"0\" aria-level=\"3\" role=\"heading\">' + name + '</div>'),\n            columnContent = $('<div class=\"board_column_content\"></div>'),\n            columnNewContent = $('<div class=\"board_column_newcontent\"></div>');\n        columnHeader.append(columnSort);\n        columnHeader.append(columnName);\n\n        if (options.hideheaders) {\n            columnName.addClass('d-none');\n        }\n\n        columnSort.on('click', function() {\n            sortNotes(columnContent, true);\n        });\n\n        if (iseditable) {\n            column.addClass('mod_board_editablecolumn');\n\n            var removeElement = $('<div class=\"mod_board_remove fa fa-remove delete_column\" role=\"button\" tabindex=\"0\"></div>');\n            handleAction(removeElement, function() {\n                Notification.confirm(\n                    strings.remove_column_text.split(\". \")[1], // Are you sure?\n                    strings.remove_column_text.split(\". \")[0], // This will effect others.\n                    strings.Ok,\n                    strings.Cancel,\n                    function() {\n                        serviceCall('delete_column', {id: ident}, function(result) {\n                            if (result.status) {\n                                column.remove();\n                                lastHistoryId = result.historyid;\n                            }\n                        });\n                    }\n                );\n            });\n\n            columnHeader.append(removeElement);\n        }\n\n        column.append(columnHeader);\n        column.append(columnContent);\n        column.append(columnNewContent);\n\n        if (iseditable) {\n            handleEditableAction(columnName, function() {\n                nameCache = columnName.html();\n            }, true);\n\n            columnName.editable({\n                toggleFontSize: false,\n                closeOnEnter: true,\n                callback: function(data) {\n                    if (data.content) {\n                        serviceCall('update_column', {id: ident, name: columnName.html()}, function(result) {\n                            if (!result.status) {\n                                columnName.html(nameCache);\n                                nameCache = null;\n                            } else {\n                                lastHistoryId = result.historyid;\n                                updateColumnAria(ident);\n                            }\n                        }, function() {\n                            columnName.html(nameCache);\n                            nameCache = null;\n                        });\n                    } else {\n                        columnName.html(nameCache);\n                        nameCache = null;\n                    }\n                }\n            });\n        }\n\n        if (!isReadOnlyBoard) {\n            columnNewContent.append('<div class=\"board_button newnote\" role=\"button\" tabindex=\"0\">' +\n            '<div class=\"button_content\"><span class=\"fa ' + options.noteicon + '\"></span></div></div>');\n\n            handleAction(columnNewContent.find('.newnote'), function() {\n                addNote(ident, 0, null, null, null, {id: userId}, 0, 0);\n            });\n        }\n\n        var lastOne = $(\".mod_board .board_column_hasdata\").last();\n        if (lastOne.length) {\n            column.insertAfter(lastOne);\n        } else {\n            $(\".mod_board\").append(column);\n        }\n\n        if (notes) {\n            for (var index in notes) {\n                addNote(ident, notes[index].id, notes[index].heading, notes[index].content,\n                    {type: notes[index].type, info: notes[index].info, url: notes[index].url},\n                    {id: notes[index].userid}, notes[index].timecreated, notes[index].rating);\n            }\n        }\n        sortNotes(columnContent);\n        updateColumnAria(ident);\n        if (isEditor) {\n            updateSortable();\n        }\n    };\n\n    /**\n     * Add the new column button.\n     *\n     * @method addNewColumnButton\n     */\n    var addNewColumnButton = function() {\n        var column = $('<div class=\"board_column board_column_empty\"></div>'),\n            newBusy = false;\n        column.append('<div class=\"board_button newcolumn\" role=\"button\" tabindex=\"0\" aria-label=\"' +\n        strings.aria_newcolumn + '\"><div class=\"button_content\"><span class=\"fa ' + options.columnicon +\n        '\"></span></div></div>');\n\n        handleAction(column.find('.newcolumn'), function() {\n            if (newBusy) {\n                return;\n            }\n            newBusy = true;\n\n            serviceCall('add_column', {boardid: board.id, name: strings.default_column_heading}, function(result) {\n                addColumn(result.id, strings.default_column_heading);\n                lastHistoryId = result.historyid;\n                newBusy = false;\n            }, function() {\n                newBusy = false;\n            });\n        });\n\n        $(\".mod_board\").append(column);\n    };\n\n    /**\n     * Update a note with the provided information.\n     *\n     * @method updateNote\n     * @param note\n     * @param heading\n     * @param data\n     */\n    var updateNote = function(note, heading, data) {\n        heading.html(data.heading);\n        if (data.heading) {\n            heading.show();\n        } else {\n            heading.hide();\n        }\n        getNoteTextForNote(note).html(data.content);\n        setAttachment(note, data.attachment);\n        updateNoteAria(data.id);\n    };\n\n    /**\n     * Fetch and process the recent board history.\n     *\n     * @method processBoardHistory\n     */\n    var processBoardHistory = function() {\n        serviceCall('board_history', {id: board.id, since: lastHistoryId}, function(boardhistory) {\n            for (var index in boardhistory) {\n                var item = boardhistory[index];\n                if (item.boardid != board.id) {\n                    continue; // Hmm\n                }\n\n                var data = JSON.parse(item.content);\n                if (item.action == 'add_note') {\n                    addNote(data.columnid, data.id, data.heading, data.content, data.attachment,\n                        {id: item.userid}, data.timecreated, data.rating);\n                    updateNoteAria(data.id);\n                    sortNotes($('.board_column[data-ident=' + data.columnid + '] .board_column_content'));\n                } else if (item.action == 'update_note') {\n                    var note = getNote(data.id);\n                    if (note) {\n                        var heading = getNoteHeadingForNote(note);\n\n                        if (editingNote == data.id) {\n                            Notification.confirm(\n                                strings.note_changed_text.split(\"\\n\")[0], // Confirm.\n                                strings.note_changed_text.split(\"\\n\")[1], // Are you sure?\n                                strings.Ok,\n                                strings.Cancel,\n                                function(note, heading, data) {\n                                    updateNote(note, heading, data);\n                                    stopNoteEdit();\n                                }\n                            );\n                        } else {\n                            updateNote(note, heading, data);\n                        }\n                    }\n                } else if (item.action == 'delete_note') {\n                    if (editingNote == data.id) {\n                        Notification.alert(strings.warning, strings.note_deleted_text);\n                        stopNoteEdit();\n                    }\n                    getNote(data.id).remove();\n\n                } else if (item.action == 'add_column') {\n                    addColumn(data.id, data.name);\n                } else if (item.action == 'update_column') {\n                    $(\".board_column[data-ident='\" + data.id + \"'] .mod_board_column_name\").html(data.name);\n                    updateColumnAria(data.id);\n                } else if (item.action == 'delete_column') {\n                    var column = $(\".board_column[data-ident='\" + data.id + \"']\");\n                    if (editingNote && column.find('.board_note[data-ident=\"' + editingNote + '\"]').length) {\n                        stopNoteEdit();\n                    }\n                    column.remove();\n                } else if (item.action == 'rate_note') {\n                    var note = getNote(data.id);\n                    note.find('.mod_board_rating').html(data.rating);\n                    if (sortby == SORTBY_RATING) {\n                        sortNotes(note.closest('.board_column_content'));\n                    }\n                }\n                lastHistoryId = item.id;\n            }\n\n            updateBoard();\n        });\n    };\n\n    /**\n     * Trigger a board update.\n     *\n     * @method updateBoard\n     * @param instant\n     */\n    var updateBoard = function(instant) {\n        if (instant) {\n            processBoardHistory();\n        } else if (options.history_refresh > 0) {\n            if (reloadTimer) {\n                stopUpdating();\n            }\n            reloadTimer = setTimeout(processBoardHistory, options.history_refresh * 1000);\n        }\n    };\n\n    /**\n     * Stop/prevent the board reload timer from firing.\n     *\n     * @method stopUpdating\n     */\n    var stopUpdating = function() {\n        clearTimeout(reloadTimer);\n        reloadTimer = null;\n    };\n\n    /**\n     * Sort a set of notes.\n     *\n     * @sortNotes\n     * @param content\n     * @param toggle\n     */\n    var sortNotes = function(content, toggle) {\n        var sortCol = $(content).parent().find('.mod_board_column_sort'),\n            direction = $(content).data('sort');\n        if (!direction) {\n            if (sortby == SORTBY_RATING) {\n                direction = 'desc';\n            } else {\n                direction = 'asc';\n            }\n        }\n        if (toggle) {\n            direction = direction == 'asc' ? 'desc' : 'asc';\n        }\n\n        if (direction == 'asc') {\n            sortCol.removeClass('fa-angle-down');\n            sortCol.addClass('fa-angle-up');\n        } else {\n            sortCol.removeClass('fa-angle-up');\n            sortCol.addClass('fa-angle-down');\n        }\n        $(content).data('sort', direction);\n\n        var desc,\n            asc;\n        if (sortby == SORTBY_DATE) {\n            desc = function(a, b) {\n                return $(b).data(\"sortorder\") - $(a).data(\"sortorder\");\n            };\n            asc = function(a, b) {\n                return $(a).data(\"sortorder\") - $(b).data(\"sortorder\");\n            };\n        } else {\n            desc = function(a, b) {\n                return $(b).find('.mod_board_rating').text() - $(a).find('.mod_board_rating').text() ||\n                $(b).data(\"sortorder\") - $(a).data(\"sortorder\");\n            };\n            asc = function(a, b) {\n                return $(a).find('.mod_board_rating').text() - $(b).find('.mod_board_rating').text() ||\n                $(a).data(\"sortorder\") - $(b).data(\"sortorder\");\n            };\n        }\n\n        $('> .board_note', $(content)).sort(direction === 'asc' ? asc : desc).appendTo($(content));\n\n    };\n\n    /**\n     * Update sorting of sortable content.\n     *\n     * @method updateSortable\n     */\n    var updateSortable = function() {\n        $(\".board_column_content\").sortable({\n            connectWith: \".board_column_content\",\n            stop: function(e, ui) {\n                var note = $(ui.item),\n                    tocolumn = note.closest('.board_column'),\n                    columnid = tocolumn.data('ident'),\n                    elem = $(this);\n\n                serviceCall('move_note', {id: note.data('ident'), columnid: columnid}, function(result) {\n                    if (result.status) {\n                        lastHistoryId = result.historyid;\n                        updateNoteAria(note.data('ident'));\n                        sortNotes($('.board_column[data-ident=' + columnid + '] .board_column_content'));\n                    } else {\n                        elem.sortable('cancel');\n                    }\n                });\n            }\n        });\n    };\n\n    /**\n     * Get the body fragment for the modal form.\n     *\n     * @param noteid\n     * @param columnid\n     * @returns {Deferred|*}\n     */\n    var getBody = function(noteid, columnid) {\n        // Get the content of the modal.\n        var params = {noteid: noteid, columnid: columnid};\n        return Fragment.loadFragment('mod_board', 'note_form', contextid, params);\n    };\n\n    /**\n     * Displays the modal form to edit a note.\n     *\n     * @param note\n     */\n    var showModalForm = function(note) {\n        let noteid = 0,\n            columnid = note.data('column'),\n            title = strings.modal_title_new;\n\n        if (note.data('ident')) {\n            noteid = note.data('ident');\n            title = strings.modal_title_edit;\n        }\n\n        ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            title: title,\n            body: getBody(noteid, columnid),\n            large: true,\n            removeOnClose: true\n        }).then(function(modal) {\n            modal.getBodyPromise().then(function () {\n\n                modal.setLarge();\n                modal.setSaveButtonText(strings.post_button_text);\n                modal.setButtonText('cancel', strings.cancel_button_text);\n\n                modal.getRoot().on(ModalEvents.hidden, function () {\n                    stopNoteEdit();\n                    if (!note.data('ident')) {\n                        note.remove();\n                    }\n                });\n\n                modal.getRoot().on(ModalEvents.save, function (e) {\n                    e.preventDefault();\n                    modal.getRoot().find('form').submit();\n                });\n\n                var changeEvent = document.createEvent('HTMLEvents');\n                changeEvent.initEvent('change', true, true);\n\n                modal.getRoot().on('submit', 'form', function (e) {\n                    e.preventDefault();\n\n                    // Prompt all inputs to run their validation functions.\n                    // Normally this would happen when the form is submitted, but\n                    // since we aren't submitting the form normally we need to run client side\n                    // validation.\n                    modal.getRoot().find(':input').each(function (index, element) {\n                        element.dispatchEvent(changeEvent);\n                    });\n\n                    // Now the change events have run, see if there are any \"invalid\" form fields.\n                    var invalid = $.merge(\n                        modal.getRoot().find('[aria-invalid=\"true\"]'),\n                        modal.getRoot().find('.error')\n                    );\n\n                    // If we found invalid fields, focus on the first one and do not submit via ajax.\n                    if (invalid.length) {\n                        invalid.first().focus();\n                        return;\n                    }\n\n                    var formData = JSON.stringify(modal.getRoot().find('form').serialize());\n                    serviceCall('submit_form', {contextid: contextid, jsonformdata: formData}, function (result) {\n                        if (result.status) {\n                            if (result.action == 'insert') {\n                                // Added a new note.\n                                lastHistoryId = result.historyid;\n                                note.remove();\n                                addNote(columnid, result.note.id, result.note.heading, result.note.content,\n                                    {type: result.note.type, info: result.note.info, url: result.note.url},\n                                    {id: result.note.userid}, result.note.timecreated, result.note.rating);\n                                sortNotes($('.board_column[data-ident=' + columnid + '] .board_column_content'));\n                                updateNoteAria(result.note.id);\n                            } else {\n                                // Updated existing note.\n                                lastHistoryId = result.historyid;\n                                getNoteTextForNote(note).html(result.note.content);\n                                getNoteHeadingForNote(note).html(result.note.heading);\n                                updateNoteAria(result.note.id);\n                                setAttachment(note, {\n                                    type: result.note.type,\n                                    info: result.note.info, url: result.note.url\n                                });\n                            }\n                            stopNoteEdit();\n\n                            // Clear the form changed checker.\n                            Y.use('moodle-core-formchangechecker', function() {\n                                M.core_formchangechecker.reset_form_dirty_state();\n                            });\n\n                            modal.hide();\n                        } else {\n                            // TODO show error.\n                        }\n                    });\n\n                });\n\n                if (mediaSelection == MEDIA_SELECTION_BUTTONS) {\n                    // First hide the select menu.\n                    modal.getRoot().find('#fitem_id_mediatype').hide();\n\n                    let mediaSelect = modal.getRoot().find('#fitem_id_mediatype select'),\n                        ytButton = modal.getRoot().find('.mod_board_attachment_button.youtube_button'),\n                        pictureButton = modal.getRoot().find('.mod_board_attachment_button.image_button'),\n                        linkButton = modal.getRoot().find('.mod_board_attachment_button.link_button'),\n                        updateMediaButtons = function() {\n                            ytButton.removeClass('selected');\n                            pictureButton.removeClass('selected');\n                            linkButton.removeClass('selected');\n                            switch (mediaSelect.val()) {\n                                case (\"1\"):\n                                    ytButton.addClass('selected');\n                                    break;\n                                case (\"2\"):\n                                    pictureButton.addClass('selected');\n                                    break;\n                                case (\"3\"):\n                                    linkButton.addClass('selected');\n                                    break;\n                            }\n                        };\n\n                    updateMediaButtons();\n                    ytButton.on('click', function () {\n                        if (mediaSelect.val() === \"1\") {\n                            mediaSelect.val(0);\n                        } else {\n                            mediaSelect.val(1);\n                        }\n                        updateMediaButtons();\n                        mediaSelect[0].dispatchEvent(changeEvent);\n                    });\n                    pictureButton.on('click', function () {\n                        if (mediaSelect.val() === \"2\") {\n                            mediaSelect.val(0);\n                        } else {\n                            mediaSelect.val(2);\n                        }\n                        updateMediaButtons();\n                        mediaSelect[0].dispatchEvent(changeEvent);\n                    });\n                    linkButton.on('click', function () {\n                        if (mediaSelect.val() === \"3\") {\n                            mediaSelect.val(0);\n                        } else {\n                            mediaSelect.val(3);\n                        }\n                        updateMediaButtons();\n                        mediaSelect[0].dispatchEvent(changeEvent);\n                    });\n                } else {\n                    modal.getRoot().find('#fitem_id_mediabuttons').hide();\n                }\n\n                modal.show();\n\n                return modal;\n            });\n            return modal;\n        });\n    };\n\n    /**\n     * Initialize board.\n     *\n     * @method init\n     */\n    var init = function() {\n        serviceCall('get_board', {id: board.id}, function(columns) {\n            // Init\n            if (columns) {\n                for (var index in columns) {\n                    addColumn(columns[index].id, columns[index].name, columns[index].notes || {});\n                }\n            }\n\n            if (isEditor) {\n                addNewColumnButton();\n            }\n\n            lastHistoryId = board.historyid;\n\n            if (isEditor) {\n                updateSortable();\n            }\n\n            updateBoard();\n        });\n    };\n\n    // Get strings\n    var stringsInfo = [];\n    for (var string in strings) {\n        stringsInfo.push({key: string, component: 'mod_board'});\n    }\n\n    $.when(getStrings(stringsInfo)).done(function(results) {\n        var index = 0;\n        for (string in strings) {\n            strings[string] = results[index++];\n        }\n\n        init();\n    });\n}\n"],"file":"board.min.js"}